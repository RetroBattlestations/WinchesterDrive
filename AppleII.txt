 100  GOSUB 3010: GOSUB 2010 110 X = W / 2 - 1:Y = H / 2 - 1:FC = 0:FL = FC 115  GOSUB 1010 120 KE$ = "":NX = X:NY = Y 130  IF  PEEK (49152) < 128 THEN 130 140  GET KE$ 150  IF KE$ = "i" OR KE$ = "I" THEN NY = Y - 1:FC =  INT (FC / 2) * 2 + 1: IF NY < 0 THEN NY = 0: IF NX = W / 2 - 1 AND  MID$ (DR$,1,1) <  > " " THEN  GOSUB 2010:NX = W / 2 - 1:NY = H - 2: GOTO 210 160  IF KE$ = "j" OR KE$ = "J" THEN NX = X - 1:FC = FC -  INT (FC / 2) * 2 + 2: IF NX < 0 THEN NX = 0: IF NY = H / 2 - 1 AND  MID$ (DR$,3,1) <  > " " THEN  GOSUB 2010:NX = W - 2:NY = H / 2 - 1: GOTO 210 170  IF KE$ = "k" OR KE$ = "K" THEN NX = X + 1:FC = FC -  INT (FC / 2) * 2: IF NX > W - 2 THEN NX = W - 2: IF NY = H / 2 - 1 AND  MID$ (DR$,4,1) <  > " " THEN  GOSUB 2010:NX = 0:NY = H / 2 - 1: GOTO 210 180  IF KE$ = "m" OR KE$ = "M" THEN NY = Y + 1:FC =  INT (FC / 2) * 2: IF NY > H - 2 THEN NY = H - 2: IF NX = W / 2 - 1 AND  MID$ (DR$,2,1) <  > " " THEN  GOSUB 2010:NX = W / 2 - 1:NY = 0: GOTO 210 190  IF NX = X AND NY = Y THEN 120 200  GOSUB 1510 210 X = NX:Y = NY:FL = FC: GOSUB 1010 220  GOTO 120 999  END  1000  REM  Draw character 1010 XP = X * 16 + 8 + XO:YP = Y * 16 + 8 + YO 1020  ON FC + 1 GOTO 1030,1040,1050,1060 1030  HCOLOR= 7: DRAW 1 AT XP + 1,YP + 2: DRAW 3 AT XP + 2,YP + 15: HCOLOR= 3: DRAW 2 AT XP + 3,YP + 8: RETURN  1040  HCOLOR= 7: DRAW 4 AT XP + 1,YP + 2: DRAW 6 AT XP + 2,YP + 12: HCOLOR= 3: DRAW 5 AT XP + 3,YP + 8: RETURN  1050  HCOLOR= 7: DRAW 7 AT XP + 13,YP + 2: DRAW 9 AT XP + 10,YP + 15: HCOLOR= 3: DRAW 8 AT XP + 12,YP + 10: RETURN  1060  HCOLOR= 7: DRAW 10 AT XP + 13,YP + 2: DRAW 12 AT XP + 10,YP + 15: HCOLOR= 3: DRAW 11 AT XP + 11,YP + 8: RETURN  1500  REM  Erase character  1510 XP = X * 16 + 8 + XO:YP = Y * 16 + 8 + YO 1520  ON FL + 1 GOTO 1530,1540,1550,1560 1530  HCOLOR= 0: DRAW 1 AT XP + 1,YP + 2: DRAW 2 AT XP + 3,YP + 8: DRAW 3 AT XP + 2,YP + 15: RETURN  1540  HCOLOR= 0: DRAW 4 AT XP + 1,YP + 2: DRAW 5 AT XP + 3,YP + 8: DRAW 6 AT XP + 2,YP + 12: RETURN  1550  HCOLOR= 0: DRAW 7 AT XP + 13,YP + 2: DRAW 8 AT XP + 12,YP + 10: DRAW 9 AT XP + 10,YP + 15: RETURN  1560  HCOLOR= 0: DRAW 10 AT XP + 13,YP + 2: DRAW 11 AT XP + 11,YP + 8: DRAW 12 AT XP + 10,YP + 15: RETURN  2000  REM     Create room 2010  HGR : POKE 49234,0 2020 W =  INT ( RND (1) * 4) * 2 + 6:H =  INT ( RND (1) * 4) * 2 + 6 2030 CN =  INT ( RND (1) * 3) 2040 XO = (280 - W * 16) / 2:YO = (192 - H * 16) / 2 2050 WC = 1 +  INT ( RND (1) * 4): IF WC > 2 THEN WC = WC + 2 2060  HCOLOR= WC 2070  FOR I = 0 TO 3 2080  HPLOT XO + 16,YO + I TO XO + (W - 1) * 16,YO + I 2090  HPLOT XO + 16,YO + I + H * 16 - 4 TO XO + (W - 1) * 16,YO + I + H * 16 - 4 2100  HPLOT XO + I,YO + 16 TO XO + I,YO + (H - 1) * 16 2110  HPLOT XO + I + W * 16 - 4,YO + 16 TO XO + I + W * 16 - 4,YO + (H - 1) * 16 2120  NEXT  2130  ROT= 48: DRAW CN + 13 AT XO,YO + 15: ROT= 32: DRAW CN + 13 AT XO + 15,YO + H * 16 - 1 2140  ROT= 16: DRAW CN + 13 AT XO + W * 16 - 1,YO + (H - 1) * 16: ROT= 0: DRAW CN + 13 AT XO + (W - 1) * 16,YO 2150 DR =  INT ( RND (1) * 16): IF  NOT DR THEN 2150 2160 DR$ = "":DS$ = " N S W E" 2170  FOR I = 1 TO 4 2180 DD = DR -  INT (DR / 2) * 2:DR =  INT (DR / 2):DR$ = DR$ +  MID$ (DS$,I * 2 - 1 + DD,1) 2190  IF  NOT DD THEN 2420 2200 NS = I < 3:S = I = 2:E = I = 4 2230  FOR J = 0 TO 3 2240  HCOLOR=  INT (WC / 4) * 4 2250 X1 = (W * 16 / (NS + 1)) * (NS + E) - 12 * NS - 4 * E + J * (1 - NS) 2260 X2 = (W * 16 / (NS + 1)) * (NS + E) + 11 * NS - 4 * E + J * (1 - NS) 2270 Y1 = (H * 16 / ((1 - NS) + 1)) * ((1 - NS) + S) - 12 * (1 - NS) - 4 * S + J * NS 2280 Y2 = (H * 16 / ((1 - NS) + 1)) * ((1 - NS) + S) + 11 * (1 - NS) - 4 * S + J * NS 2290  HPLOT XO + X1,YO + Y1 TO XO + X2,YO + Y2 2300  HCOLOR=  INT (WC / 4) * 4 + 3 2310 X1 = (W * 16 / (NS + 1)) * (NS + E) - 16 * NS - 8 * E + J * NS 2320 X2 = (W * 16 / (NS + 1)) * (NS + E) - 16 * NS - 8 * E + 7 * (1 - NS) + J * NS 2330 Y1 = (H * 16 / (1 - NS + 1)) * (1 - NS + S) - 16 * (1 - NS) - 8 * S + J * (1 - NS) 2340 Y2 = (H * 16 / (1 - NS + 1)) * (1 - NS + S) - 16 * (1 - NS) - 8 * S + 7 * NS + J * (1 - NS) 2350  HPLOT XO + X1,YO + Y1 TO XO + X2,YO + Y2 2360 X1 = (W * 16 / (NS + 1)) * (NS + E) + 12 * NS - 8 * E + J * NS 2370 X2 = (W * 16 / (NS + 1)) * (NS + E) + 12 * NS - 8 * E + 7 * (1 - NS) + J * NS 2380 Y1 = (H * 16 / (1 - NS + 1)) * (1 - NS + S) + 12 * (1 - NS) - 8 * S + J * (1 - NS) 2390 Y2 = (H * 16 / (1 - NS + 1)) * (1 - NS + S) + 12 * (1 - NS) - 8 * S + 7 * NS + J * (1 - NS) 2400  HPLOT XO + X1,YO + Y1 TO XO + X2,YO + Y2 2410  NEXT J 2420  NEXT I 2430  RETURN  3000  REM  Load shape table 3010  PRINT "Loading shape table..." 3020 SH = 25000:SA = SH: ROT= 0: SCALE= 1 3030  POKE 232,SH -  INT (SH / 256) * 256 3040  POKE 233, INT (SH / 256) 3050  READ D: IF D < 0 THEN  RETURN  3060  POKE SA,D:SA = SA + 1: GOTO 3050 9000  REM  Shape table data 9010  DATA  15,0,32,0,73,0,84,0,94,0,120,0,130,0,139,0,185,0,198,0,208,0,234,0,246 9020  DATA  0,255,0,52,1,109,1,54,54,78,36,36,36,149,18,54,37,36,36,172,50,54,46 9030  DATA  36,193,32,36,149,178,50,37,36,36,36,149,178,50,37,4,193,193,36,108,50 9040  DATA  30,54,54,0,54,55,109,36,44,53,119,110,36,44,0,36,108,54,110,36,44,53 9050  DATA  54,5,0,54,54,78,36,36,36,13,54,54,54,13,36,36,36,108,54,54,54,110,36 9060  DATA  36,36,108,50,6,0,54,110,36,108,54,46,37,103,44,0,54,110,36,108,54,110 9070  DATA  36,44,0,54,54,222,39,37,103,36,252,54,54,54,39,36,36,193,24,54,182,50 9080  DATA  39,4,193,193,4,193,193,51,54,54,54,39,4,193,193,4,193,193,51,54,150,62 9090  DATA  193,36,228,36,0,62,36,252,54,62,193,32,55,54,31,36,60,0,36,252,54,254 9100  DATA  36,60,55,54,7,0,54,54,222,36,36,36,31,54,54,54,31,36,36,36,252,54,54 9110  DATA  54,254,36,36,36,252,50,6,0,54,254,36,252,54,62,36,193,51,54,7,0,36,252 9120  DATA  54,254,36,252,54,62,0,45,53,63,55,45,53,63,55,45,45,62,63,119,45,173 9130  DATA  63,63,46,45,173,63,63,46,45,45,109,17,63,63,63,63,14,45,45,45,45,45,53 9140  DATA  63,63,63,63,63,78,45,45,45,45,62,63,63,7,0,45,53,63,55,45,53,63,55,54 9150  DATA  46,36,44,54,46,36,44,45,109,58,63,63,46,45,45,53,63,63,63,14,45,45,45 9160  DATA  62,63,55,45,45,62,63,46,45,45,45,62,63,63,63,46,45,45,45,62,63,63,63,7 9170  DATA  0,54,46,36,44,54,46,36,172,109,58,63,46,45,21,63,63,14,45,53,63,55,45 9180  DATA  45,45,141,63,63,63,63,14,53,37,53,37,53,46,36,53,46,172,58,63,46,45,62 9190  DATA  63,46,45,5,0,-1